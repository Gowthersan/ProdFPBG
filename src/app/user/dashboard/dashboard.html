<app-toast-host></app-toast-host>

<!-- USER DASHBOARD — FPBG (vue adaptée à la maquette) -->
<div class="min-h-screen bg-[#F7F9FC] text-[#0B1F2C]">
  <!-- Header -->
  <header class="px-6 pt-8 pb-4">
    <div class="grid grid-cols-1 md:grid-cols-[1fr,auto] items-start gap-6">
      <div>
        <h1 class="text-[28px] md:text-[34px] font-semibold tracking-tight drop-shadow-sm">Tableau de bord</h1>
        <p class="text-slate-500 mt-1">Votre espace projet FPBG.</p>
      </div>

      <!-- Profil à droite -->
      <div class="flex items-center gap-3">
        <div class="text-right leading-tight">
          <div class="text-[12px] md:text-[13px] font-semibold uppercase">
            {{ user().fullName }}
          </div>
          <div class="text-[11px] text-emerald-600 font-semibold">PORTEUR DE PROJET</div>
        </div>

        <ng-container *ngIf="!imgError(); else fallbackAvatar">
          <img [ngSrc]="user().photoUrl || ''" (error)="imgError.set(true)" width="44" height="44" alt="Avatar"
               class="h-11 w-11 rounded-full object-cover ring-2 ring-emerald-500/70 bg-white"/>
        </ng-container>
        <ng-template #fallbackAvatar>
          <div class="h-11 w-11 rounded-full grid place-items-center bg-emerald-50 text-emerald-700 font-semibold ring-2 ring-emerald-500/70">
            {{ initials() }}
          </div>
        </ng-template>
      </div>
    </div>
  </header>

  <main class="px-6 pb-12">
    <!-- Cartes x4 -->
    <section class="grid gap-6 md:grid-cols-2 bg-[#F3F6FB] rounded-3xl p-6 md:p-8 border border-slate-200">
      <!-- Nom du projet -->
      <article class="rounded-[26px] bg-white p-6 shadow-sm border border-slate-200">
        <div class="flex items-center gap-2 text-sm text-emerald-700 font-semibold">
          <!-- Lucide user-round -->
          <svg class="h-5 w-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
               stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
            <circle cx="12" cy="8" r="5"></circle><path d="M20 21a8 8 0 0 0-16 0"></path>
          </svg>
          Nom du projet
        </div>
        <p class="mt-2 font-semibold capitalize leading-snug">{{ projectName() || '—' }}</p>
        <button class="mt-3 rounded-md border px-3 py-1.5 text-sm hover:bg-slate-50" (click)="primaryActionClick()">
          voir mon projet
        </button>
      </article>

      <!-- Statut -->
      <article class="rounded-[26px] bg-white p-6 shadow-sm border border-slate-200">
        <div class="flex items-center gap-2 text-sm text-emerald-700 font-semibold">
          <!-- Lucide file-text -->
          <svg class="h-5 w-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
               stroke-linecap="round" stroke-linejoin="round">
            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
            <path d="M14 2v6h6"></path>
            <path d="M16 13H8"></path><path d="M16 17H8"></path><path d="M10 9H8"></path>
          </svg>
          Votre Projet
        </div>

        <div class="mt-2 text-sm">
          <span class="text-slate-500">Statut :</span>
          <span class="ml-2 rounded-full px-2 py-0.5 text-xs" [class]="statusClass()">{{ status() || '—' }}</span>
        </div>

        <button class="mt-3 rounded-md border px-3 py-1.5 text-sm hover:bg-slate-50" (click)="goRecap()">
          voir récapitulatif
        </button>
      </article>

      <!-- Collaborateur (CTA) -->
      <article class="rounded-[26px] bg-white p-6 shadow-sm border border-slate-200">
        <div class="flex items-center gap-2 text-sm text-indigo-700 font-semibold">
          <!-- Lucide shield -->
          <svg class="h-5 w-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
               stroke-linecap="round" stroke-linejoin="round">
            <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path>
          </svg>
          Collaborateur
        </div>

        <button class="mt-4 rounded-md border px-3 py-1.5 text-sm hover:bg-slate-50"
                (click)="showAddCollaborator.set(true); scrollTo('collab')">
          Ajouter un Collaborateur
        </button>
      </article>

      <!-- Dernière mise à jour -->
      <article class="rounded-[26px] bg-white p-6 shadow-sm border border-slate-200">
        <div class="flex items-center gap-2 text-sm text-indigo-700 font-semibold">
          <!-- Lucide calendar -->
          <svg class="h-5 w-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
               stroke-linecap="round" stroke-linejoin="round">
            <path d="M8 2v4"></path><path d="M16 2v4"></path>
            <rect x="3" y="4" width="18" height="18" rx="2"></rect><path d="M3 10h18"></path>
          </svg>
          Dernière mise à jour
        </div>

        <p class="mt-4 text-2xl font-semibold">
          {{ lastUpdate() ? (lastUpdate() | date:'short') : '—' }}
        </p>
      </article>
    </section>

    <!-- Collaborateurs -->
    <section id="collab" class="mt-8">
      <div class="flex items-center justify-between">
        <div class="flex items-center gap-2">
          <svg class="h-6 w-6 text-indigo-700" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
               stroke-linecap="round" stroke-linejoin="round">
            <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path>
          </svg>
          <h2 class="text-lg font-semibold">Collaborateurs</h2>
        </div>

        <button class="inline-flex items-center gap-2 rounded-md bg-emerald-600 hover:bg-emerald-500 text-white px-3 py-2"
                (click)="addCollaborator()">
          <span class="text-lg leading-none">+</span> Ajouter
        </button>
      </div>

      <p class="text-slate-500 mt-1" *ngIf="!collaborators().length">Aucun collaborateur pour le moment.</p>

      <!-- Inline form -->
      <div class="mt-4 rounded-2xl bg-white border border-slate-200 p-5">
        <form class="grid gap-4 md:grid-cols-[1.4fr,1.2fr,0.9fr] items-end" [formGroup]="collabForm">
          <div>
            <label class="block text-sm text-slate-600 mb-1">Nom complet</label>
            <input class="w-full rounded-md border px-3 py-2 bg-white focus:outline-none focus:ring-2 focus:ring-emerald-500"
                   formControlName="fullName" placeholder="Nom prénom" />
          </div>

          <div>
            <label class="block text-sm text-slate-600 mb-1">Messagerie électronique</label>
            <input class="w-full rounded-md border px-3 py-2 bg-white focus:outline-none focus:ring-2 focus:ring-emerald-500"
                   formControlName="email" placeholder="nom@domaine.com"/>
          </div>

          <div>
            <label class="block text-sm text-slate-600 mb-1">Rôle</label>
            <select class="w-full rounded-md border px-3 py-2 bg-white focus:outline-none focus:ring-2 focus:ring-emerald-500"
                    formControlName="role">
              <option>Éditeur</option>
              <option>Lecteur</option>
              <option>Admin projet</option>
            </select>
          </div>
        </form>

        <div class="mt-3">
          <button class="inline-flex items-center gap-2 rounded-md bg-emerald-600 hover:bg-emerald-500 text-white px-4 py-2"
                  (click)="addCollaborator()">
            <span class="text-lg leading-none">+</span> Ajouter
          </button>
        </div>
      </div>

      <!-- Liste -->
      <div class="mt-4" *ngIf="collaborators().length">
        <ul class="divide-y rounded-2xl border bg-white">
          <li *ngFor="let c of collaborators()" class="p-4 flex items-center justify-between">
            <div>
              <p class="font-medium">{{ c.fullName }}</p>
              <p class="text-xs text-slate-500">{{ c.email }}</p>
            </div>
            <span class="text-xs bg-slate-100 px-2 py-0.5 rounded-full">{{ c.role }}</span>
          </li>
        </ul>
      </div>
    </section>
  </main>
</div>
