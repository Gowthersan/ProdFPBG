<div class="min-h-screen grid place-items-center bg-[#1f3b52] px-4">
  <div
    class="w-full max-w-3xl rounded-3xl bg-[#0F2434] text-white p-8 md:p-10 shadow-2xl border border-white/10"
  >
    <!-- Logo + titre -->
    <div class="flex justify-center">
      <img src="assets/logo.png" alt="FPBG" class="w-auto h-12" />
    </div>
    <h1 class="mt-4 text-3xl font-bold text-center">Bienvenue</h1>

    <!-- Onglets -->
    <div class="grid max-w-md grid-cols-2 gap-6 mx-auto mt-6">
      <a
        routerLink="/login"
        class="rounded-md bg-[#1F3B52] text-slate-200 px-6 py-2 text-center font-semibold hover:bg-[#21435e] transition"
      >
        Connexion
      </a>
      <button
        type="button"
        class="px-6 py-2 font-semibold text-center transition bg-green-600 rounded-md hover:bg-green-500"
      >
        Inscription
      </button>
    </div>

    <!-- Stepper -->
    <div class="flex items-center justify-center gap-6 mt-7">
      <div
        class="flex items-center justify-center w-8 h-8 rounded-full"
        [ngClass]="{ 'bg-green-600': step() >= 1, 'bg-[#1F3B52]': step() < 1 }"
      >
        1
      </div>
      <div class="w-12 h-0.5 bg-slate-600"></div>
      <div
        class="flex items-center justify-center w-8 h-8 rounded-full"
        [ngClass]="{ 'bg-green-600': step() === 2, 'bg-[#1F3B52]': step() !== 2 }"
      >
        2
      </div>
    </div>

    <h2 class="mt-5 text-lg font-semibold text-center">
      {{ step() === 1 ? 'Informations sur l’organisme' : 'Informations sur le demandeur' }}
    </h2>

    <!-- Alerte erreur globale -->
    <div
      *ngIf="error()"
      class="px-4 py-3 mt-4 border rounded-md transition-all duration-300"
      [ngClass]="{
        'text-red-200 border-red-500/30 bg-red-500/10': !emailAlreadyUsed(),
        'text-yellow-200 border-yellow-500/50 bg-yellow-500/20 animate-pulse': emailAlreadyUsed()
      }"
    >
      <div class="flex items-start gap-2">
        <svg *ngIf="emailAlreadyUsed()" class="w-5 h-5 mt-0.5 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
          <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"/>
        </svg>
        <div class="flex-1">
          {{ error() }}
          <a *ngIf="emailAlreadyUsed()" routerLink="/login" class="block mt-2 underline hover:text-white">
            → Se connecter avec cet email
          </a>
        </div>
      </div>
    </div>

    <!-- ===== Étape 1 : Organisme ===== -->
    <form *ngIf="step() === 1" class="grid gap-4 mt-6" [formGroup]="form" (ngSubmit)="next()">
      <!-- Nom org -->
      <div>
        <label class="block mb-1 text-sm text-slate-300">Nom de l’organisation</label>
        <input
          formControlName="nom_organisation"
          class="w-full rounded-md bg-[#1F3B52] border border-white/10 px-4 py-2.5"
          placeholder="Association d’agriculture"
        />
        <p
          class="mt-1 text-xs text-red-300"
          *ngIf="form.get('nom_organisation')?.touched && form.get('nom_organisation')?.invalid"
        >
          Nom de l’organisation requis.
        </p>
      </div>

      <!-- Type org -->
      <div>
        <label class="block mb-1 text-sm text-slate-300">Type d’organisation</label>
        <select
          formControlName="type"
          class="w-full rounded-md bg-[#1F3B52] border border-white/10 px-4 py-2.5"
        >
          <option value="">-- Sélectionner --</option>
          <option *ngFor="let t of type" [value]="t">{{ t }}</option>
        </select>
        <p
          class="mt-1 text-xs text-red-300"
          *ngIf="form.get('type')?.touched && form.get('type')?.invalid"
        >
          Type d’organisation requis.
        </p>
      </div>

      <!-- Couverture -->
      <div>
        <label class="block mb-1 text-sm text-slate-300">Couverture géographique</label>
        <select
          formControlName="couvertureGeographique"
          class="w-full rounded-md bg-[#1F3B52] border border-white/10 px-4 py-2.5"
        >
          <option value="">-- Sélectionner --</option>
          <option *ngFor="let c of couvertureGeographique" [value]="c">{{ c }}</option>
        </select>
        <p
          class="mt-1 text-xs text-red-300"
          *ngIf="
            form.get('couvertureGeographique')?.touched &&
            form.get('couvertureGeographique')?.invalid
          "
        >
          Couverture requise.
        </p>
      </div>

      <!-- Type de subvention -->
      <div>
        <label class="block mb-1 text-sm text-slate-300">Type de subvention</label>
        <div class="grid grid-cols-1 gap-3 md:grid-cols-2">
          <label
            class="flex items-center gap-2 rounded-md bg-[#1F3B52] border border-white/10 px-4 py-2.5 cursor-pointer"
          >
            <input
              type="radio"
              class="accent-green-600"
              formControlName="typeSubvention"
              value="Petite subvention"
            />
            <span>Petite subvention</span>
          </label>
          <label
            class="flex items-center gap-2 rounded-md bg-[#1F3B52] border border-white/10 px-4 py-2.5 cursor-pointer"
          >
            <input
              type="radio"
              class="accent-green-600"
              formControlName="typeSubvention"
              value="Moyenne subvention"
            />
            <span>Moyenne subvention</span>
          </label>
        </div>
        <p
          class="mt-1 text-xs text-red-300"
          *ngIf="form.get('typeSubvention')?.touched && form.get('typeSubvention')?.invalid"
        >
          Choisissez un type de subvention.
        </p>
      </div>

      <!-- Email/Tel org -->
      <div class="grid gap-4 md:grid-cols-2">
        <div>
          <label class="block mb-1 text-sm text-slate-300">Email de contact</label>
          <input
            type="email"
            formControlName="email"
            class="w-full rounded-md bg-[#1F3B52] px-4 py-2.5 transition-all duration-300"
            [ngClass]="{
              'border border-white/10': !form.get('email')?.hasError('emailUsed'),
              'border-2 border-yellow-500 bg-yellow-500/10': form.get('email')?.hasError('emailUsed')
            }"
            placeholder="fpbg@gmail.com"
          />
          <p
            class="mt-1 text-xs text-red-300"
            *ngIf="form.get('email')?.touched && form.get('email')?.hasError('email')"
          >
            Email valide requis.
          </p>
          <p
            class="mt-1 text-xs text-yellow-300 font-medium"
            *ngIf="form.get('email')?.hasError('emailUsed')"
          >
            ⚠️ Cet email est déjà enregistré. Utilisez un autre email ou connectez-vous.
          </p>
        </div>
        <div>
          <label class="block mb-1 text-sm text-slate-300">Téléphone</label>
          <input
            formControlName="telephone"
            class="w-full rounded-md bg-[#1F3B52] border border-white/10 px-4 py-2.5"
            placeholder="0XX XX XX XX ou +241XXXXXXXX"
          />
          <p
            class="mt-1 text-xs text-red-300"
            *ngIf="form.get('telephone')?.touched && form.get('telephone')?.hasError('required')"
          >
            Téléphone requis.
          </p>
          <p
            class="mt-1 text-xs text-red-300"
            *ngIf="form.get('telephone')?.touched && form.get('telephone')?.hasError('gabonPhone')"
          >
            Format invalide. Utilisez 0XX XX XX XX (ex. 061 23 45 67) ou +241XXXXXXXX.
          </p>
        </div>
      </div>

      <!-- Actions -->
      <div class="flex justify-center gap-3 mt-3">
        <button
          type="submit"
          [disabled]="loading()"
          class="rounded-md bg-green-600 hover:bg-green-500 px-8 py-2.5 font-semibold disabled:opacity-60 disabled:cursor-not-allowed transition"
        >
          Suivant
        </button>
      </div>
    </form>

    <!-- ===== Étape 2 : Demandeur ===== -->
    <form *ngIf="step() === 2" class="grid gap-4 mt-6" [formGroup]="form" (ngSubmit)="submit()">
      <!-- <h2 class="text-lg font-semibold text-center">Informations sur le Demandeur</h2> -->

      <!-- Prénom & Nom -->
      <div class="grid gap-4 md:grid-cols-2">
        <div>
          <label class="block mb-1 text-sm text-slate-300">Prénom</label>
          <input
            formControlName="prenom"
            class="w-full rounded-md bg-[#1F3B52] border border-white/10 px-4 py-2.5"
            placeholder="Jean"
          />
          <p
            class="mt-1 text-xs text-red-300"
            *ngIf="form.get('prenom')?.touched && form.get('prenom')?.invalid"
          >
            Prénom requis.
          </p>
        </div>
        <div>
          <label class="block mb-1 text-sm text-slate-300">Nom</label>
          <input
            formControlName="nom"
            class="w-full rounded-md bg-[#1F3B52] border border-white/10 px-4 py-2.5"
            placeholder="Dupont"
          />
          <p
            class="mt-1 text-xs text-red-300"
            *ngIf="form.get('nom')?.touched && form.get('nom')?.invalid"
          >
            Nom requis.
          </p>
        </div>
      </div>

      <!-- Contact -->
      <div>
        <label class="block mb-1 text-sm text-slate-300">Personne de contact</label>
        <input
          formControlName="personneContact"
          class="w-full rounded-md bg-[#1F3B52] border border-white/10 px-4 py-2.5"
          placeholder="Nom Prénom"
        />
        <p
          class="mt-1 text-xs text-red-300"
          *ngIf="form.get('personneContact')?.touched && form.get('personneContact')?.invalid"
        >
          Nom du contact requis.
        </p>
      </div>

      <!-- Poste -->
      <div>
        <label class="block mb-1 text-sm text-slate-300">Fonction</label>
        <input
          formControlName="fonction"
          class="w-full rounded-md bg-[#1F3B52] border border-white/10 px-4 py-2.5"
          placeholder="Responsable projet"
        />
      </div>

      <!-- Tel / Email -->
      <div class="grid gap-4 md:grid-cols-2">
        <div>
          <label class="block mb-1 text-sm text-slate-300">Téléphone</label>
          <input
            formControlName="telephone"
            class="w-full rounded-md bg-[#1F3B52] border border-white/10 px-4 py-2.5"
            placeholder="0XX XX XX XX ou +241XXXXXXXX"
          />
          <p
            class="mt-1 text-xs text-red-300"
            *ngIf="form.get('telephone')?.touched && form.get('telephone')?.hasError('required')"
          >
            Téléphone requis.
          </p>
          <p
            class="mt-1 text-xs text-red-300"
            *ngIf="form.get('telephone')?.touched && form.get('telephone')?.hasError('gabonPhone')"
          >
            Format invalide. Utilisez 0XX XX XX XX (ex. 061 23 45 67) ou +241XXXXXXXX.
          </p>
        </div>
        <div>
          <label class="block mb-1 text-sm text-slate-300">Email</label>
          <input
            type="email"
            formControlName="email"
            class="w-full rounded-md bg-[#1F3B52] px-4 py-2.5 transition-all duration-300"
            [ngClass]="{
              'border border-white/10': !form.get('email')?.hasError('emailUsed'),
              'border-2 border-yellow-500 bg-yellow-500/10': form.get('email')?.hasError('emailUsed')
            }"
            placeholder="fpbg@gmail.com"
          />
          <p
            class="mt-1 text-xs text-red-300"
            *ngIf="form.get('email')?.touched && form.get('email')?.hasError('email')"
          >
            Email valide requis.
          </p>
          <p
            class="mt-1 text-xs text-yellow-300 font-medium"
            *ngIf="form.get('email')?.hasError('emailUsed')"
          >
            ⚠️ Cet email est déjà enregistré. Utilisez un autre email ou connectez-vous.
          </p>
        </div>
      </div>

      <!-- Password / Confirm -->
      <div class="grid gap-4 md:grid-cols-2">
        <div>
          <label class="block mb-1 text-sm text-slate-300">Mot de passe</label>
          <input
            type="password"
            formControlName="motDePasse"
            class="w-full rounded-md bg-[#1F3B52] border border-white/10 px-4 py-2.5"
            placeholder="********"
          />
          <p
            class="mt-1 text-xs text-red-300"
            *ngIf="form.get('motDePasse')?.touched && form.get('motDePasse')?.invalid"
          >
            Mot de passe requis (6 caractères minimum).
          </p>
        </div>
        <div>
          <label class="block mb-1 text-sm text-slate-300">Confirmer le mot de passe</label>
          <input
            type="password"
            formControlName="confirmMotDePasse"
            class="w-full rounded-md bg-[#1F3B52] border border-white/10 px-4 py-2.5"
            placeholder="********"
          />
          <p
            class="mt-1 text-xs text-red-300"
            *ngIf="
              form.get('confirmMotDePasse')?.touched &&
              (form.get('confirmMotDePasse')?.invalid ||
                form.value.motDePasse !== form.value.confirmMotDePasse)
            "
          >
            Confirmation invalide : les mots de passe doivent correspondre.
          </p>
        </div>
      </div>

      <!-- Actions -->
      <div class="flex justify-center gap-3 mt-3">
        <button
          type="button"
          (click)="step.set(1)"
          class="rounded-md bg-slate-600 hover:bg-slate-500 px-8 py-2.5 font-semibold transition"
        >
          Retour
        </button>
        <button
          type="submit"
          [disabled]="loading()"
          class="rounded-md bg-green-600 hover:bg-green-500 px-8 py-2.5 font-semibold disabled:opacity-60 disabled:cursor-not-allowed transition"
        >
          <span *ngIf="!loading()">Créer le compte</span>
          <span *ngIf="loading()">Création en cours...</span>
        </button>
      </div>
    </form>
  </div>
</div>
