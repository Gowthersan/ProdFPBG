<div class="max-w-6xl px-4 py-8 mx-auto sm:px-6 lg:px-8 bg-slate-50">
  <!-- GROSSE CARD -->
  <article class="overflow-hidden bg-white border shadow-xl rounded-2xl border-slate-200">
    <!-- Bandeau -->
    <div class="border-b bg-gradient-to-r from-green-100 to-sky-50">
      <div class="w-full h-1 bg-green-500"></div>
      <div class="px-6 py-6">
        <p class="text-xs font-semibold tracking-wider uppercase text-green-700/80">
          {{ aap().code }}
        </p>
        <h1 class="mt-1 text-2xl font-bold leading-snug sm:text-3xl text-slate-900">
          {{ aap().titre }}
        </h1>
        <p class="max-w-3xl mt-3 text-slate-700">
          {{ aap().resume }}
        </p>

        <!-- Chips subventions -->
        <div class="flex flex-wrap gap-2 mt-4">
          <ng-container *ngFor="let g of aap().grants">
            <span
              class="inline-flex items-center gap-2 px-3 py-1 text-sm bg-white border rounded-full"
            >
              <span
                class="w-2 h-2 rounded-full"
                [ngClass]="{
                  'bg-green-600': g.name === 'Petite subvention',
                  'bg-sky-600': g.name !== 'Petite subvention'
                }"
              ></span>
              <strong>{{ g.name }}</strong>
              <span class="text-slate-500">¬∑</span>
              <span class="text-slate-600">{{ timelineBadge(g) }}</span>
            </span>
          </ng-container>
        </div>
      </div>
    </div>

    <!-- Corps -->
    <div class="grid gap-6 px-6 py-6 lg:grid-cols-3">
      <!-- Colonne principale -->
      <div class="space-y-6 lg:col-span-2">
        <!-- Contexte & objectif -->
        <section class="p-5 bg-white border rounded-xl">
          <h2 class="font-semibold text-slate-900">Contexte</h2>
          <p class="mt-2 text-slate-700">{{ aap().contexte }}</p>
          <h3 class="mt-4 font-semibold text-slate-900">Objectif</h3>
          <p class="mt-2 text-slate-700">{{ aap().objectif }}</p>
        </section>

        <!-- Th√©matiques √©ligibles -->
        <section class="bg-white border rounded-xl">
          <button
            (click)="toggle('thematiques')"
            class="flex items-center justify-between w-full px-5 py-4 text-left"
          >
            <div class="font-semibold text-slate-900">Th√©matiques √©ligibles</div>
            <div class="text-sm text-slate-500">
              {{ open() === 'thematiques' ? 'Replier' : 'D√©plier' }}
            </div>
          </button>
          <div *ngIf="open() === 'thematiques'" class="px-5 pb-5">
            <h4 class="mb-2 text-sm font-semibold text-green-700">Petite subvention</h4>
            <div class="space-y-5">
              <div *ngFor="let t of aap().thematiquesPetites" class="p-4 border rounded-lg">
                <div class="font-medium text-slate-900">{{ t.title }}</div>
                <ul class="pl-5 mt-2 space-y-1 list-disc text-slate-700">
                  <li *ngFor="let b of t.bullets">{{ b }}</li>
                </ul>
              </div>
            </div>

            <h4 class="mt-6 mb-2 text-sm font-semibold text-sky-700">Subvention moyenne</h4>
            <div class="space-y-5">
              <div *ngFor="let t of aap().thematiquesMoyennes" class="p-4 border rounded-lg">
                <div class="font-medium text-slate-900">{{ t.title }}</div>
                <ul class="pl-5 mt-2 space-y-1 list-disc text-slate-700">
                  <li *ngFor="let b of t.bullets">{{ b }}</li>
                </ul>
              </div>
            </div>
          </div>
        </section>

        <!-- Modalit√©s & Processus -->
        <section class="bg-white border rounded-xl">
          <button
            (click)="toggle('modalites')"
            class="flex items-center justify-between w-full px-5 py-4 text-left"
          >
            <div class="font-semibold text-slate-900">Pr√©paration & traitement des demandes</div>
            <div class="text-sm text-slate-500">
              {{ open() === 'modalites' ? 'Replier' : 'D√©plier' }}
            </div>
          </button>
          <div *ngIf="open() === 'modalites'" class="px-5 pb-5 space-y-3 text-slate-700">
            <p>
              <span class="font-medium text-slate-900">Modalit√©s de demande :</span>
              D√©p√¥t physique au si√®ge du FPBG ou en ligne en envoyant un dossier unique (PDF) √†
              <a
                class="text-green-700 underline hover:no-underline"
                href="mailto:{{ aap().contactEmail }}"
                >{{ aap().contactEmail }}</a
              >.
            </p>
            <p>
              <span class="font-medium text-slate-900">Formulation :</span>
              remplir le <em>formulaire standard de Note Conceptuelle</em> et joindre les pi√®ces
              list√©es en annexe. Des √©changes compl√©mentaires peuvent √™tre demand√©s.
            </p>
            <p>
              <span class="font-medium text-slate-900">Appui :</span>
              ateliers d‚Äôinformation et d‚Äôaccompagnement technique (dates/lieux communiqu√©s sur le
              site).
            </p>
            <p>
              <span class="font-medium text-slate-900">Traitement :</span>
              analyse selon des crit√®res techniques, environnementaux, sociaux et financiers. Les
              projets innovants et √† fort impact sont privil√©gi√©s.
            </p>
            <p>
              <span class="font-medium text-slate-900">Communication des r√©sultats :</span>
              publication sur le site du FPBG et envoi par courriel (et courrier papier).
            </p>
            <p>
              <span class="font-medium text-slate-900">Mise en ≈ìuvre / gestion :</span>
              signature d‚Äôun contrat de subvention ; rapports techniques & financiers
              (interm√©diaires et finaux) requis.
            </p>
          </div>
        </section>

        <!-- Annexes -->
        <section class="bg-white border rounded-xl">
          <button
            (click)="toggle('annexes')"
            class="flex items-center justify-between w-full px-5 py-4 text-left"
          >
            <div class="font-semibold text-slate-900">Annexes ‚Äì pi√®ces justificatives</div>
            <div class="text-sm text-slate-500">
              {{ open() === 'annexes' ? 'Replier' : 'D√©plier' }}
            </div>
          </button>
          <div *ngIf="open() === 'annexes'" class="px-5 pb-5">
            <ol class="pl-5 space-y-1 list-decimal text-slate-700">
              <li *ngFor="let it of aap().annexes">{{ it }}</li>
            </ol>
          </div>
        </section>
      </div>

      <!-- Colonne lat√©rale : r√©sum√© -->
      <aside class="space-y-6">
        <!-- Carte r√©sum√© grants -->
        <section class="p-5 bg-white border rounded-xl">
          <h3 class="font-semibold text-slate-900">R√©sum√© des subventions</h3>
          <div class="mt-3 space-y-4">
            <div *ngFor="let g of aap().grants" class="p-4 border rounded-lg bg-slate-50">
              <div class="flex items-center justify-between">
                <div class="font-medium">{{ g.name | titlecase }}</div>
                <span
                  class="text-xs rounded-full px-2 py-0.5 border"
                  [ngClass]="{
                    'bg-green-100 text-green-700 border-green-300': g.name === 'Petite subvention',
                    'bg-sky-100 text-sky-700 border-sky-300': g.name !== 'Petite subvention'
                  }"
                >
                  {{ g.durationMaxMonths }} mois max
                </span>
              </div>
              <div class="mt-1 text-sm text-slate-700">
                {{ fmtCurrency(g.amountMin) }} ‚Äì {{ fmtCurrency(g.amountMax) }}
              </div>
              <div class="mt-2 text-xs text-slate-600">
                <div>üéØ Lancement : {{ g.launchDate | date : 'd MMMM y' }}</div>
                <div>
                  ‚è≥ Deadline (Note conceptuelle) :
                  <strong>{{ g.deadlineNoteConceptuelle | date : 'd MMMM y' }}</strong>
                </div>
                <div class="mt-1 italic">{{ grantDeadlineLabel(g) }}</div>
              </div>
              <!-- Timeline courte -->
              <details class="mt-3">
                <summary class="text-sm font-medium cursor-pointer text-slate-700">
                  Chronogramme
                </summary>
                <ul class="pl-5 mt-2 space-y-1 text-sm list-disc text-slate-700">
                  <li *ngFor="let s of g.cycle">
                    <span class="font-medium">{{ s.step }} :</span> {{ s.dates }}
                  </li>
                </ul>
              </details>
            </div>
          </div>
          <div class="mt-4 space-y-3">
            <a
              routerLink="/login"
              class="inline-flex items-center justify-center w-full rounded-lg bg-green-600 text-white px-4 py-2.5 font-medium hover:bg-green-700 transition-colors"
            >
              Je candidate
            </a>
            <a
              href="assets/documents/appel-a-projet.pdf"
              download
              class="inline-flex items-center justify-center w-full rounded-lg bg-white border-2 border-green-600 text-green-600 px-4 py-2.5 font-medium hover:bg-green-50 transition-colors gap-2"
            >
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"
                />
              </svg>
              T√©l√©charger le PDF
            </a>
          </div>
        </section>

        <!-- Eligibilit√© -->
        <section class="p-5 bg-white border rounded-xl">
          <h3 class="font-semibold text-slate-900">√âligibilit√©</h3>
          <div class="mt-3">
            <h4 class="text-sm font-semibold text-slate-800">G√©ographique</h4>
            <ul class="pl-5 mt-1 space-y-1 text-sm list-disc text-slate-700">
              <li *ngFor="let it of aap().geographicEligibility">{{ it }}</li>
            </ul>
          </div>

          <div class="mt-4">
            <h4 class="text-sm font-semibold text-slate-800">Organisations √©ligibles</h4>
            <ul class="pl-5 mt-1 space-y-1 text-sm list-disc text-slate-700">
              <li *ngFor="let it of aap().eligibleOrganisations">{{ it }}</li>
            </ul>
          </div>

          <div class="mt-4">
            <h4 class="text-sm font-semibold text-slate-800">Activit√©s & d√©penses √©ligibles</h4>
            <ul class="pl-5 mt-1 space-y-1 text-sm list-disc text-slate-700">
              <li *ngFor="let it of aap().eligibleActivities">{{ it }}</li>
            </ul>
          </div>

          <div class="mt-4 text-sm text-slate-700">
            <span class="font-medium text-slate-900">Cofinancement :</span>
            {{ aap().cofinancement }}
          </div>
        </section>

        <!-- Contact -->
        <section class="p-5 bg-white border rounded-xl">
          <h3 class="font-semibold text-slate-900">Contact</h3>
          <p class="mt-2 text-sm text-slate-700">
            Pour toute question :
            <a class="text-green-700 underline" href="mailto:{{ aap().contactEmail }}">{{
              aap().contactEmail
            }}</a>
          </p>
        </section>
      </aside>
    </div>
  </article>
</div>
